<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Living Card - Lord of the Eternal Host</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel+Decorative&family=UnifrakturMaguntia&display=swap');

    :root{
      /* Tweak these if your PNG window is a hair off */
      --win-top: 25%;
      --win-right: 15%;
      --win-bottom: 45%;
      --win-left: 15%;
      --win-radius: 18px;
    }

    body{
      font-family:'MedievalSharp',cursive;
      --font-gothic:'UnifrakturMaguntia',cursive;
      overflow:hidden;
      background:#000;
      cursor:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><path fill='%23ffffff' d='M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z'/></svg>"),auto;
    }

    .card-container {
      perspective: 1000px;
      width: 100%;
      max-width: min(90vw, 600px);
      aspect-ratio: 2/3;
      margin: 0 auto;
    }
    .card {
      background: transparent;
      box-shadow: 0 0 70px rgba(255,215,0,.8), inset 0 0 40px rgba(255,191,0,.7);
      transform-style: preserve-3d;
      will-change: transform;
      position: relative;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      transition: transform 0.1s ease-out;
      border-radius: 16px;
      overflow: hidden;
    }

    @media (prefers-reduced-motion: reduce) {
      .card {
        transform: none !important;
        transition: none !important;
      }
    }

    .character-zone{position:relative;overflow:hidden;}

    .character-overlay{
      position:absolute;top:0;left:0;width:100%;height:100%;
      mix-blend-mode:overlay;opacity:.3;pointer-events:none;
    }

    .glow-effect{
      position:absolute;width:100%;height:100%;
      background:radial-gradient(circle at center, rgba(255,215,0,.6) 0%, transparent 70%);
      animation:pulse 2s infinite alternate;pointer-events:none;filter:blur(10px);
    }

    .name-banner{font-family:'Cinzel Decorative',cursive;text-shadow:0 0 15px rgba(0,255,255,.9);letter-spacing:2px;}
    .lore-panel{background:url('http://static.photos/red/1200x630/42') center/cover;box-shadow:inset 0 0 20px rgba(0,0,0,.7);}
    .stat-icon{transition:all .3s ease;}
    .stat-icon:hover{transform:scale(1.2);filter:drop-shadow(0 0 12px #ffd700);}
    .cursor-trail{
      position:absolute;width:20px;height:20px;border-radius:50%;
      background:rgba(255,215,0,.7);pointer-events:none;z-index:9999;transform:translate(-50%,-50%);mix-blend-mode:screen;
    }
    
    /* Celebration particles */
    .celebration-particle {
      position: absolute;
      z-index: 9999;
      filter: drop-shadow(0 0 10px currentColor);
      animation: particle-fall 2s ease-out forwards;
    }
    
    @keyframes particle-fall {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(100px) scale(0.2); opacity: 0; }
    }
    @keyframes pulse{0%{opacity:.3}100%{opacity:.7}}
    @keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
    .floating{animation:float 6s ease-in-out infinite;}

    /* Video container */
    .video-container {
      position: absolute;
      inset: 0;
      z-index: 1;
    }
    .video-container video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Card frame */
    .card-frame {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 2;
      pointer-events: none;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .card-container {
        max-width: 95vw;
      }
    }
    @media (max-width: 480px) {
      .card-container {
        aspect-ratio: 3/4;
      }
    }
  </style>
</head>
<body class="h-screen w-screen flex items-center justify-center p-4 bg-black">

  <div id="cursor-trails"></div>

  <div class="card-container">
    <div id="card" class="card w-full h-full rounded-lg flex flex-col relative">
      <div class="glow-effect"></div>

      <!-- Character Zone -->
      <div class="character-zone flex-1 relative overflow-hidden" style="height:100%;">

        <!-- background tint (subtle, stays behind) -->
        <div class="absolute inset-0 bg-black/60"></div>

        <!-- Video background -->
        <div class="video-container" aria-hidden="true">
          <video autoplay muted loop playsinline preload="auto">
            <source src="background.mp4" type="video/mp4">
          </video>
        </div>

        <!-- Card frame overlay -->
        <img
          src="./OG%20Base%20card%20special%20silver.png"
          alt=""
          class="card-frame"
          loading="lazy"
        />

        <div class="character-overlay"></div>

        <!-- Soft center glow -->
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="w-3/4 h-3/4 bg-gradient-to-b from-transparent via-yellow-900/10 to-transparent rounded-full filter blur-xl opacity-30"></div>
        </div>
      </div>

      <!-- Scoreboard -->
      <div id="scoreboard" class="absolute top-4 left-4 bg-black/70 rounded-lg p-2 hidden" style="z-index: 9999;">
        <div class="text-cyan-300 font-bold mb-1">რეკორდი</div>
        <div id="scores-container" class="flex flex-col gap-1"></div>
      </div>

      <!-- Tap Counter Game -->
      <div id="tap-game-container" class="absolute inset-0 flex items-start justify-center pt-[15%] hidden pointer-events-none z-50">
        <div class="relative">
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-48 h-48 rounded-full bg-yellow-900/80 border-6 border-yellow-700 blur-sm"></div>
          </div>
          <div class="relative bg-yellow-900/90 rounded-full w-48 h-48 flex items-center justify-center border-6 border-yellow-700 shadow-lg">
            <div id="tap-count" class="text-5xl font-bold hidden font-gothic text-yellow-200 transition-all duration-300">0</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Audio Element -->
  <audio id="ambient-sound" loop>
    <source src="https://www.soundjay.com/misc/sounds/wind-chime-01.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Initialize libraries
    AOS.init();
    feather.replace();

    // Scoreboard empty state
    const scoresContainer = document.getElementById('scores-container');
    const emptyScore = document.createElement('div');
    emptyScore.className = 'score text-gray-500 text-sm';
    emptyScore.textContent = '---';
    scoresContainer.appendChild(emptyScore);

    // Reset scale and scores on double tap
    document.addEventListener('dblclick', () => {
      document.querySelectorAll('.score').forEach(s=>{
        s.textContent='---'; s.classList.add('text-gray-500'); s.classList.remove('text-white');
      });
      scale = 1;
      card.style.transform = card.style.transform.replace(/scale\([^)]*\)/,'scale(1)');
    });

    // Device motion & touch handling
    let scale = 1;
    let initialDistance = null;
    const card = document.getElementById('card');

    // Touch rotate
    let touchStartX=0,touchStartY=0,currentX=0,currentY=0,isDragging=false;
    document.addEventListener('touchstart',e=>{
      if(e.touches.length===1){isDragging=true;touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY;}
    });
    document.addEventListener('touchmove',e=>{
      if(isDragging&&e.touches.length===1){
        e.preventDefault();
        const tx=e.touches[0].clientX, ty=e.touches[0].clientY;
        currentX=(tx-touchStartX)/10; currentY=(ty-touchStartY)/10;
        card.style.transform=`rotateY(${currentX}deg) rotateX(${-currentY}deg) scale(${scale})`;
      }
    },{passive:false});
    document.addEventListener('touchend',()=>{
      isDragging=false;
      gsap.to(card,{rotateY:0,rotateX:0,duration:.5,ease:"elastic.out(1,0.3)"});
      currentX=0; currentY=0;
    });

    // Mouse parallax + trail
    let lastTime = 0;
    const throttleRate = 16; // ~60fps
    
    function handleMouseMove(e) {
      const now = Date.now();
      if (now - lastTime < throttleRate) return;
      lastTime = now;
      
      requestAnimationFrame(() => {
        const xAxis = (window.innerWidth/2 - e.pageX)/25;
        const yAxis = (window.innerHeight/2 - e.pageY)/25;
        card.style.transform = `rotateY(${xAxis}deg) rotateX(${yAxis}deg) scale(${scale})`;
      });
    }
    
    document.addEventListener('mousemove', handleMouseMove);

      const trail=document.createElement('div');
      trail.className='cursor-trail';
      trail.style.left=`${e.pageX}px`; trail.style.top=`${e.pageY}px`;
      document.getElementById('cursor-trails').appendChild(trail);
      setTimeout(()=>{trail.style.opacity='0';trail.style.transform='translate(-50%,-50%) scale(2)';setTimeout(()=>trail.remove(),300);},500);
    });

    // Pinch zoom
    document.addEventListener('touchstart',e=>{
      if(e.touches.length===2){
        initialDistance=Math.hypot(
          e.touches[0].clientX-e.touches[1].clientX,
          e.touches[0].clientY-e.touches[1].clientY
        );
      }
    });
    document.addEventListener('touchmove',e=>{
      if(e.touches.length===2){
        const d=Math.hypot(
          e.touches[0].clientX-e.touches[1].clientX,
          e.touches[0].clientY-e.touches[1].clientY
        );
        if(initialDistance){
          const newScale = Math.min(Math.max(scale * (d/initialDistance), .5), 3);
          scale=newScale;
          card.style.transform = card.style.transform.replace(/scale\([^)]*\)/,`scale(${scale})`);
        }
        initialDistance=d;
      }
    });
    document.addEventListener('touchend',()=>{initialDistance=null;});

    // Hover effect
    const characterZone=document.querySelector('.character-zone');
    characterZone.addEventListener('mouseenter',()=>{
      gsap.to('.character-overlay',{opacity:.5,duration:.5});
      gsap.to('.glow-effect',{opacity:.8,duration:.5});
    });
    characterZone.addEventListener('mouseleave',()=>{
      gsap.to('.character-overlay',{opacity:.3,duration:.5});
      gsap.to('.glow-effect',{opacity:.3,duration:.5});
    });

    // Ambient sound
    const ambientSound=document.getElementById('ambient-sound');
    ambientSound.volume=.3;
    const startAudio=()=>ambientSound.play();
    document.addEventListener('click',startAudio,{once:true});
    document.addEventListener('touchstart',startAudio,{once:true});

    // Tap Counter Game
    const tapGameContainer=document.getElementById('tap-game-container');
    const tapCount=document.getElementById('tap-count');
    const finalScore=document.getElementById('final-score');
    const instruction=document.getElementById('counter-instruction');
    let tapCounter=0, timeoutId=null, isCounting=false;

    document.addEventListener('click',()=>{
      if(!isCounting){
        isCounting=true; tapCounter=1;
        tapGameContainer.classList.remove('hidden');
        tapCount.textContent=tapCounter; tapCount.classList.remove('hidden');
        instruction?.classList.add('hidden'); finalScore?.classList.add('hidden');
        gsap.to('.glow-effect',{opacity:.8,duration:.2});
        setTimeout(()=>gsap.to('.glow-effect',{opacity:.3,duration:.5}),200);
        const a=new Audio('https://www.soundjay.com/misc/sounds/magic-chime-01.mp3'); a.volume=.2; a.play();
      }else{
        tapCounter++; tapCount.textContent=tapCounter;
        if(tapCounter % 5 === 0){
          gsap.to('#card',{rotateZ:Math.random()*10-5,duration:.2,yoyo:true,repeat:1});
        }
      }

      clearTimeout(timeoutId);
      timeoutId=setTimeout(()=>{
        isCounting=false;
        tapCount.textContent=tapCounter;
        tapCount.classList.add('text-6xl');

        const colors=['#ff0000','#ff9900','#ffff00','#00ff00','#0099ff','#9900ff'];
        for(let i=0;i<30;i++){
          setTimeout(()=>{
            const fw=document.createElement('div');
            fw.className='absolute rounded-full w-2 h-2';
            const c=colors[Math.floor(Math.random()*colors.length)];
            fw.style.background=c; fw.style.left=`${Math.random()*100}%`; fw.style.top=`${Math.random()*100}%`;
            fw.style.boxShadow=`0 0 10px 2px ${c}`;
            document.getElementById('card').appendChild(fw);
            gsap.to(fw,{x:(Math.random()-.5)*200,y:(Math.random()-.5)*200,scale:5,opacity:0,duration:1,onComplete:()=>fw.remove()});
          },i*50);
        }

        // Celebration effects
        const a2 = new Audio('https://www.soundjay.com/misc/sounds/sci-fi-sound-effect-01.mp3'); 
        a2.volume = 0.7;
        a2.play();

        // Create celebration particles
        for(let i=0;i<100;i++){
          setTimeout(()=>{
            const particle = document.createElement('div');
            particle.className = 'absolute rounded-full w-3 h-3 z-50';
            const colors = ['#00ffff', '#ff00ff', '#ffff00', '#00ff00'];
            const color = colors[Math.floor(Math.random()*colors.length)];
            particle.style.background = color;
            particle.style.left = `${Math.random()*100}%`;
            particle.style.top = `${Math.random()*100}%`;
            particle.style.boxShadow = `0 0 15px 5px ${color}`;
            document.getElementById('card').appendChild(particle);
            
            gsap.to(particle, {
              x: (Math.random()-.5)*300,
              y: (Math.random()-.5)*300,
              scale: Math.random()*5 + 2,
              opacity: 0,
              duration: 2,
              ease: "power2.out",
              onComplete: () => particle.remove()
            });
          }, i*20);
        }

        // Glow pulse effect
        gsap.to('.glow-effect', {
          opacity: 0.9,
          duration: 0.3,
          yoyo: true,
          repeat: 3,
          ease: "sine.inOut"
        });

        setTimeout(()=>{
          tapCount.classList.remove('text-6xl');
          tapGameContainer.classList.add('hidden');

          const scoreEls = scoresContainer.querySelectorAll('.score');
          const newScore=document.createElement('div');
          newScore.className='score text-white text-sm'; newScore.textContent=tapCounter;
          if(scoreEls.length>0){scoreEls[0].remove();}
          scoresContainer.appendChild(newScore);
          document.getElementById('scoreboard').classList.remove('hidden');
        },1500);
      },1000);
    });
  </script>
</body>
</html>
